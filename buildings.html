<!DOCTYPE html>

<html lang="cs">

<head>

<meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Budovy a Voj√°ci</title>

<link rel="icon" href="favicon.ico" type="image/x-icon" />

<style>

  body {

    margin:0; font-family: Arial, sans-serif; background: #f4f1e6;

  }

  header {

    background:#333; color:#fff; padding:10px;

    display:flex; justify-content: space-between; align-items:center;

  }

  nav a {

    color:#fff; text-decoration:none; margin:0 10px; padding:5px 10px;

    border-radius:5px; cursor:pointer;

  }

  nav a:hover {

    background:#555;

  }

 .resources {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #e8e4d8;
  padding: 10px;
  margin-top: 5px;
  font-weight: bold;
}

.resources div {
  display: inline-block;
  margin-right: 20px;
  font-size: 16px;
}

#tokens {
  color: #d4af37; /* Zlat√° barva pro tokeny */
}

  #tabs {

    display:flex; justify-content:center; margin-top: 15px;

    gap: 15px;

  }

  #tabs button {

    padding:8px 20px; font-weight:bold; font-size:16px;

    border:none; border-radius:10px; cursor:pointer;

    background:#c4a76d; color:#fff; transition: background 0.3s ease;

  }

  #tabs button.active {

    background:#a78e4a;

  }

  #tabs button:hover:not(.active) {

    background:#b7a561;

  }

  .tab-content {

    max-width: 900px; margin: 20px auto; background:#fff9e6;

    border: 2px solid #c4a76d; border-radius:15px; padding: 20px;

    box-shadow: 0 4px 15px rgba(0,0,0,0.1);

  }

  .building-card, .unit-card, .research-card {

    background:#fff; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);

    padding:15px; margin-bottom:15px; display:flex; align-items:center;

    gap:15px; user-select:none;

  }

  .building-card.inactive, .unit-card.inactive, .research-card.inactive {

    filter: grayscale(100%); opacity:0.4; cursor:default;

    position: relative;

  }

  .building-card.inactive::after, .unit-card.inactive::after, .research-card.inactive::after {

    content: "Zamƒçeno";

    position: absolute; right: 15px; top: 15px;

    font-weight: bold; color: #a33; font-size: 14px;

  }

  .icon {

    font-size: 48px; width:60px; text-align:center;

  }

  .details {

    flex-grow:1;

  }

  .title {

    font-weight: bold; font-size: 18px; margin-bottom: 5px;

  }

  .level {

    margin-bottom: 5px;

  }

  .btn {

    background:#c4a76d; border:none; border-radius:8px;

    color:#fff; font-weight:bold; padding: 8px 15px;

    cursor:pointer; transition: background 0.3s ease;

  }

  .btn:disabled {

    background:#aaa; cursor:not-allowed;

  }

  .btn:hover:not(:disabled) {

    background:#a78e4a;

  }

  .timer {

    font-family: monospace; color: #a33; font-weight: bold;

  }

  #army-list {

    display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;

  }

  .army-unit {

    background:#fff; border-radius:10px; box-shadow:0 0 8px rgba(0,0,0,0.15);

    width: 120px; padding:10px; text-align:center;

    user-select:none; position: relative;

  }

  .army-unit .icon {

    font-size: 40px;

  }

  .army-unit .count {

    font-weight:bold; font-size: 18px; margin-top: 8px;

  }

  #research-list, #training-list, #training-stable-list {

    max-height: 300px; overflow-y: auto;

  }

  #addTokensBtn {
  background-color: #4caf50;
  color: white;
  padding: 10px 20px;
  border: none;
  cursor: pointer;
  font-size: 16px;
  margin-left: 20px;
}

#addTokensBtn:hover {
  background-color: #45a049;
}

  #speedUpBuildingsContainer {

    max-width: 900px;

    margin: 20px auto 40px;

    background: #fff9e6;

    border: 2px solid #c4a76d;

    border-radius: 15px;

    padding: 15px;

    box-shadow: 0 4px 15px rgba(0,0,0,0.1);

    text-align: center;

  }

  #speedUpBuildingsBtn {

    padding: 10px 25px;

    background: #c4a76d;

    color: white;

    border: none;

    border-radius: 8px;

    cursor: pointer;

    font-weight: bold;

    font-size: 16px;

    transition: background-color 0.3s ease;

  }

  #speedUpBuildingsBtn:disabled {

    background: #999;

    cursor: not-allowed;

  }

  #speedUpBuildingsBtn:hover:not(:disabled) {

    background-color: #a78e4a;

  }

</style>

</head>

<body>



<header>

  <nav>

    <a href="index.html">Pole</a>

    <a href="buildings.html">Budovy</a>

    <a href="#">Statistiky</a>

    <a href="#">Zpr√°vy</a>

  </nav>

</header>



<div class="resources">

 <div style="color:brown;">üå≤D≈ôevo: <span id="wood">0</span>/2000</div>
    <div style="color:red;">üß±Hl√≠na: <span id="clay">0</span>/2000</div>
    <div style="color:blue;">‚õèÔ∏è≈Ωelezo: <span id="iron">0</span>/2000</div>
    <div style="color:goldenrod;">üåæObil√≠: <span id="grain">0</span>/2000</div>
    <div style="color:purple;">üíé Tokeny: <span id="tokens">0</span></div>
    <button id="addTokensBtn">P≈ôidat 600 zlat√Ωch</button>
  </div>



<div id="tabs">

  <button class="tab-btn active" data-tab="buildings">Budovy</button>

  <button class="tab-btn" data-tab="barracks">Kas√°rna</button>

  <button class="tab-btn" data-tab="stable">St√°je</button>

  <button class="tab-btn" data-tab="academy">Akademie</button>

  <button class="tab-btn" data-tab="rally">Shroma≈ædi≈°tƒõ</button>

</div>



<div id="tab-buildings" class="tab-content">

  <!-- Seznam budov -->

</div>



<div id="speedUpBuildingsContainer">

  <button id="speedUpBuildingsBtn" onclick="speedUpBuildings()">Urychlit v≈°echny stavby budov za 20 token≈Ø za ka≈ædou</button>

  <div id="speedUpStatus" style="margin-top: 10px; font-weight: bold; color: green;"></div>

</div>



<div id="tab-barracks" class="tab-content" style="display:none;">

  <h2>Tr√©nink jednotek v kas√°rn√°ch</h2>

  <div id="training-list"></div>

</div>



<div id="tab-stable" class="tab-content" style="display:none;">

  <h2>Tr√©nink jezdc≈Ø ve st√°j√≠ch</h2>

  <div id="training-stable-list"></div>

</div>



<div id="tab-academy" class="tab-content" style="display:none;">

  <h2>V√Ωzkum v akademii</h2>

  <div id="research-list"></div>

</div>



<div id="tab-rally" class="tab-content" style="display:none;">

  <h2>Shroma≈ædi≈°tƒõ - p≈ôehled arm√°dy</h2>

  <div id="army-list"></div>

</div>



<script>

  // Zdroje

  let floatResources = { wood: 500, clay: 500, iron: 500, grain: 500 };

  let tokens = 100;



  // Budovy

  const buildingsList = [

    { id: 'main', name: "Hlavn√≠ budova", icon: "üè∞" },

    { id: 'granary', name: "S√Ωpka", icon: "üåæ" },

    { id: 'warehouse', name: "Sklad", icon: "üè†" },

    { id: 'barracks', name: "Kas√°rna", icon: "ü™ñ" },

    { id: 'rally', name: "Shroma≈ædi≈°tƒõ", icon: "üõ°Ô∏è" },

    { id: 'stable', name: "St√°je", icon: "üê¥" },

    { id: 'workshop', name: "D√≠lna", icon: "üîß" },

    { id: 'academy', name: "Akademie", icon: "üéì" },

    { id: 'market', name: "Tr≈ænice", icon: "üè™" },

  ];



  const baseCostsBuildings = {

    main:   { wood: 100, clay: 80, iron: 90, grain: 70, time: 20 },

    granary:{ wood: 60, clay: 40, iron: 50, grain: 30, time: 10 },

    warehouse:{ wood: 70, clay: 50, iron: 60, grain: 40, time: 10 },

    barracks:{ wood: 150, clay: 130, iron: 120, grain: 110, time: 30 },

    rally:  { wood: 120, clay: 100, iron: 90, grain: 80, time: 25 },

    stable: { wood: 160, clay: 140, iron: 130, grain: 120, time: 35 },

    workshop:{ wood: 200, clay: 180, iron: 170, grain: 150, time: 40 },

    academy:{ wood: 220, clay: 200, iron: 180, grain: 170, time: 45 },

    market: { wood: 100, clay: 90, iron: 80, grain: 70, time: 15 },

  };



  // Jednotky definice

  const unitsList = {

    barracks: [

      { id: 'palkar', name: 'Pƒõ≈°√°k (Palkar)', icon: 'üõ°Ô∏è', attack: 40, defense: 40, defInfantry:40, defCavalry:10,

        requiredBuildingLevel: 1, researched: true, trainingTime: 2, grainPerHour: 1 },

      { id: 'sekyrnik', name: 'Sekyrn√≠k', icon: 'ü™ì', attack: 60, defense: 60, defInfantry:40, defCavalry:40,

        requiredBuildingLevel: 3, researched: false, trainingTime: 3, grainPerHour: 1 },

      { id: 'ostepar', name: 'Ostepar', icon: 'ü¶µ', attack: 20, defense: 20, defInfantry:30, defCavalry:70,

        requiredBuildingLevel: 3, researched: false, trainingTime: 3, grainPerHour: 1 },

    ],

    stable: [

      { id: 'kun_tueton', name: 'K≈Ø≈à Tueton', icon: 'üê¥', attack: 120, defense: 120, defInfantry:60, defCavalry:70,

        requiredBuildingLevel: 10, researched: false, trainingTime: 5, grainPerHour: 2 },

      { id: 'ryt√≠≈ô', name: 'Ryt√≠≈ô', icon: 'üèá', attack: 70, defense: 110, defInfantry:70, defCavalry:70,

        requiredBuildingLevel: 10, researched: false, trainingTime: 6, grainPerHour: 2 },

    ],

  };



  // V√Ωzkumy v akademii

  const researchList = [

    { id: 'sekyrnik', name: 'V√Ωzkum Sekyrn√≠ka', time: 5, buildingReq: 5, buildingId: 'academy', unlocksUnit: 'sekyrnik' },

    { id: 'ostepar', name: 'V√Ωzkum Ostepara', time: 6, buildingReq: 5, buildingId: 'academy', unlocksUnit: 'ostepar' },

    { id: 'kun_tueton', name: 'V√Ωzkum K≈Ø≈à Tueton', time: 10, buildingReq: 10, buildingId: 'academy', unlocksUnit: 'kun_tueton' },

    { id: 'ryt√≠≈ô', name: 'V√Ωzkum Ryt√≠≈ôe', time: 12, buildingReq: 10, buildingId: 'academy', unlocksUnit: 'ryt√≠≈ô' },

  ];



  // Data z localStorage

  let buildingData = {};

  let armyData = {};

  let researchData = {};

  let trainingQueue = {};

  let researchQueue = {};



  // --- Naƒçten√≠ dat ---

  function loadFromStorage() {

    const bData = localStorage.getItem('buildingData');

    const aData = localStorage.getItem('armyData');

    const rData = localStorage.getItem('researchData');

    const tData = localStorage.getItem('trainingQueue');

    const resData = localStorage.getItem('researchQueue');

    const rTokens = localStorage.getItem('tokens');

    const rRes = localStorage.getItem('resources');



    buildingData = bData ? JSON.parse(bData) : {};

    armyData = aData ? JSON.parse(aData) : {};

    researchData = rData ? JSON.parse(rData) : {};

    trainingQueue = tData ? JSON.parse(tData) : {};

    researchQueue = resData ? JSON.parse(resData) : {};

    tokens = rTokens !== null ? parseInt(rTokens) : 100;

    floatResources = rRes ? JSON.parse(rRes) : { wood: 500, clay: 500, iron: 500, grain: 500 };



    buildingsList.forEach(b => {

      if (!buildingData[b.id]) {

        buildingData[b.id] = { level: b.id === 'main' ? 1 : 0, built: b.id === 'main', upgrading: false, upgradeEnd: null };

      }

    });



    Object.values(unitsList).flat().forEach(u => {

      if (armyData[u.id] === undefined) armyData[u.id] = 0;

      if (researchData[u.id] === undefined) researchData[u.id] = u.researched;

    });



    Object.keys(trainingQueue).forEach(k => {

      if (!Array.isArray(trainingQueue[k])) trainingQueue[k] = [];

    });

    Object.keys(researchQueue).forEach(k => {

      if (!researchQueue[k]) researchQueue[k] = null;

    });

  }



  // --- Ulo≈æen√≠ dat ---

  function saveToStorage() {

    localStorage.setItem('buildingData', JSON.stringify(buildingData));

    localStorage.setItem('armyData', JSON.stringify(armyData));

    localStorage.setItem('researchData', JSON.stringify(researchData));

    localStorage.setItem('trainingQueue', JSON.stringify(trainingQueue));

    localStorage.setItem('researchQueue', JSON.stringify(researchQueue));

    localStorage.setItem('tokens', tokens);

    localStorage.setItem('resources', JSON.stringify(floatResources));

  }



  // --- Aktualizace zobrazen√≠ token≈Ø ---

  function updateTokensDisplay() {

    document.getElementById('tokens').textContent = tokens;

  }



  // --- Form√°t ƒçasu ---

  function formatTime(ms) {

    if (ms <= 0) return "0:00";

    const totalSec = Math.ceil(ms / 1000);

    const min = Math.floor(totalSec / 60);

    const sec = totalSec % 60;

    return `${min}:${sec.toString().padStart(2,"0")}`;

  }



  // --- Rychlost upgradu ---

  function getSpeedMultiplier() {

    const lvl = buildingData.main ? buildingData.main.level : 1;

    return 1 + (lvl -1) * 0.1;

  }



  // --- Odemƒçen√≠ budovy ---

  



  // --- V√Ωpoƒçet ceny upgradu ---

  function calculateBuildingCost(level, id) {

    const base = baseCostsBuildings[id];

    const multiplier = level + 1;

    return {

      wood: base.wood * multiplier,

      clay: base.clay * multiplier,

      iron: base.iron * multiplier,

      grain: base.grain * multiplier,

      time: base.time * multiplier

    };

  }



  // --- Aktualizace zobrazen√≠ zdroj≈Ø ---

  function updateResourcesDisplay() {

  const baseCap = 2000;

  const warehouseLvl = buildingData.warehouse?.level || 0;

  const granaryLvl = buildingData.granary?.level || 0;

  const woodCap = baseCap + warehouseLvl * 2000;

  const clayCap = baseCap + warehouseLvl * 2000;

  const ironCap = baseCap + warehouseLvl * 2000;

  const grainCap = baseCap + granaryLvl * 2000;

  document.getElementById('wood').parentElement.innerHTML = `D≈ôevo: <span id="wood">${Math.floor(floatResources.wood)}</span>/${woodCap}`;

  document.getElementById('clay').parentElement.innerHTML = `Hl√≠na: <span id="clay">${Math.floor(floatResources.clay)}</span>/${clayCap}`;

  document.getElementById('iron').parentElement.innerHTML = `≈Ωelezo: <span id="iron">${Math.floor(floatResources.iron)}</span>/${ironCap}`;

  document.getElementById('grain').parentElement.innerHTML = `Obil√≠: <span id="grain">${Math.floor(floatResources.grain)}</span>/${grainCap}`;

  }



  // --- Kontrola, zda si m≈Ø≈æe hr√°ƒç dovolit ---

  function canAfford(cost) {

    return (

      floatResources.wood >= cost.wood &&

      floatResources.clay >= cost.clay &&

      floatResources.iron >= cost.iron &&

      floatResources.grain >= cost.grain

    );

  }



  // --- Odeƒçten√≠ zdroj≈Ø ---

  function payCost(cost) {

    floatResources.wood -= cost.wood;

    floatResources.clay -= cost.clay;

    floatResources.iron -= cost.iron;

    floatResources.grain -= cost.grain;

  }



  // --- Vykreslen√≠ budov ---


  function startTrainingUnit(unitId) {
    const unit = Object.values(unitsList).flat().find(u => u.id === unitId);
    if (!unit) return;

    // Spot≈ôeba obil√≠ bƒõhem tr√©ninku
    const grainNeeded = unit.grainPerHour / 60 * unit.trainingTime;
    if (floatResources.grain < grainNeeded) {
      alert("Nem√°≈° dostatek obil√≠ na tr√©nink.");
      return;
    }

    floatResources.grain -= grainNeeded;
    updateResourcesDisplay();

    if (!trainingQueue[unitId]) trainingQueue[unitId] = [];
    const endTime = Date.now() + unit.trainingTime * 60 * 1000;
    trainingQueue[unitId].push({ count: 1, endTime });

    saveToStorage();
    renderTraining('barracks'); // Update the training display
  }

  // --- Zobrazen√≠ tr√©ninkov√Ωch jednotek ---
  function renderTraining(buildingId) {
    let listId = buildingId === 'barracks' ? 'training-list' : 'training-stable-list';
    const container = document.getElementById(listId);
    container.innerHTML = '';

    const units = unitsList[buildingId] || [];
    units.forEach(u => {
      const unlocked = isUnlockedForTraining(buildingId) && isUnitUnlocked(u);
      const div = document.createElement('div');
      div.className = 'unit-card' + (unlocked ? '' : ' inactive');

      const icon = document.createElement('div');
      icon.className = 'icon';
      icon.textContent = u.icon;

      const details = document.createElement('div');
      details.className = 'details';

      const title = document.createElement('div');
      title.className = 'title';
      title.textContent = u.name;

      const lvlReq = document.createElement('div');
      lvlReq.textContent = `Vy≈æaduje level budovy: ${u.requiredBuildingLevel}`;

      const stats = document.createElement('div');
      stats.innerHTML = `
        √ötok: ${u.attack} | Obrana: ${u.defense} <br />
        Obrana proti pƒõchotƒõ: ${u.defInfantry} | Obrana proti kon√≠m: ${u.defCavalry} <br />
        Spot≈ôeba obil√≠: ${u.grainPerHour} / hodina <br />
        Tr√©nink trv√°: ${u.trainingTime} min
      `;

      const count = document.createElement('div');
      count.textContent = `Poƒçet: ${armyData[u.id] || 0}`;

      const btn = document.createElement('button');
      btn.className = 'btn';
      btn.textContent = unlocked ? 'Tr√©novat 1' : 'Uzamƒçeno';
      btn.disabled = !unlocked || (trainingQueue[u.id] && trainingQueue[u.id].some(t => Date.now() < t.endTime));
      btn.onclick = () => startTrainingUnit(u.id);

      details.appendChild(title);
      details.appendChild(lvlReq);
      details.appendChild(stats);
      details.appendChild(count);
      details.appendChild(btn);

      div.appendChild(icon);
      div.appendChild(details);

      container.appendChild(div);
    });
  }

  // --- Zpracov√°n√≠ fronty tr√©nov√°n√≠ ---
  function processTrainingQueue() {
    const now = Date.now();
    let changed = false;
    for (const unitId in trainingQueue) {
      const queue = trainingQueue[unitId];
      if (!queue) continue;
      for (let i = queue.length - 1; i >= 0; i--) {
        if (queue[i].endTime <= now) {
          armyData[unitId] = (armyData[unitId] || 0) + queue[i].count;
          queue.splice(i,1);
          changed = true;
        }
      }
      if (queue.length === 0) delete trainingQueue[unitId];
    }
    if (changed) {
      saveToStorage();
      renderTraining('barracks');
      renderTraining('stable');
      renderArmyList();
    }
  }

  function renderBuildings() {

    const container = document.getElementById('tab-buildings');

    container.innerHTML = '<h2>Seznam budov</h2>';

    buildingsList.forEach(b => {

      const data = buildingData[b.id];

      const unlocked = isUnlockedBuilding(b.id);

      const div = document.createElement('div');

      div.className = 'building-card' + (unlocked ? '' : ' inactive');

      if (data && data.upgrading) div.classList.add('inactive');



      const icon = document.createElement('div');

      icon.className = 'icon';

      icon.textContent = b.icon;



      const details = document.createElement('div');

      details.className = 'details';



      const title = document.createElement('div');

      title.className = 'title';

      title.textContent = b.name;



      const level = document.createElement('div');

      level.className = 'level';

      level.textContent = data && data.level > 0 ? `√örove≈à: ${data.level}` : "Nepostaveno";



      const btn = document.createElement('button');

      btn.className = 'btn';

      btn.textContent = data && data.upgrading ? "Upgraduje se..." : "Vylep≈°it";



                if (!unlocked) {

                    div.classList.add('inactive');

                    btn.disabled = true;

                } else {

                    div.classList.remove('inactive');

                    btn.disabled = false;

                }

                

      btn.onclick = () => startBuildingUpgrade(b.id);



      const timer = document.createElement('div');

      timer.className = 'timer';

      if (data && data.upgrading && data.upgradeEnd) {

        timer.textContent = "Zb√Ωv√°: " + formatTime(data.upgradeEnd - Date.now());

      }



      details.appendChild(title);

      details.appendChild(level);

      details.appendChild(btn);

      details.appendChild(timer);



      div.appendChild(icon);

      div.appendChild(details);



      container.appendChild(div);

    });

  }



  // --- Start upgradu budovy ---

  function startBuildingUpgrade(id) {

    const data = buildingData[id];

    if (data.upgrading) {

  if ((id === 'granary' || id === 'warehouse') && buildingData.main.level < 3) {

    alert("Mus√≠≈° m√≠t hlavn√≠ budovu na levelu 3.");

    return;

  }

      alert("Budova se ji≈æ vylep≈°uje.");

      return;

    }

    const cost = calculateBuildingCost(data.level, id);

    if (!canAfford(cost)) {

      alert("Nem√°≈° dostatek zdroj≈Ø na vylep≈°en√≠.");

      return;

    }

    payCost(cost);

    updateResourcesDisplay();



    const speed = getSpeedMultiplier();

    const durationMs = (cost.time * 60 * 1000) / speed;



    data.upgrading = true;

    data.upgradeEnd = Date.now() + durationMs;

    saveToStorage();

    renderBuildings();

  }



  // --- Urychlen√≠ budov tokeny ---

  function speedUpBuildings() {

    const now = Date.now();

    const upgradingBuildings = Object.entries(buildingData).filter(([id, b]) => b.upgrading && b.upgradeEnd > now);



    if (upgradingBuildings.length === 0) {

      alert("≈Ω√°dn√© prob√≠haj√≠c√≠ stavby k urychlen√≠.");

      return;

    }



    const costPerBuilding = 20;

    const totalCost = upgradingBuildings.length * costPerBuilding;



    if (tokens < totalCost) {

      alert(`Nem√°≈° dostatek token≈Ø. Pot≈ôebuje≈° ${totalCost} token≈Ø, m√°≈° ${tokens}.`);

      return;

    }



    tokens -= totalCost;



    // Dokonƒçit v≈°echny stavby najednou

    upgradingBuildings.forEach(([id, b]) => {

      b.level++;

      b.upgrading = false;

      b.upgradeEnd = null;

    });



    saveToStorage();

    renderBuildings();

    updateResourcesDisplay();

    updateTokensDisplay();



    const statusDiv = document.getElementById('speedUpStatus');

    statusDiv.textContent = `Urychleno ${upgradingBuildings.length} staveb za ${totalCost} token≈Ø.`;

    setTimeout(() => { statusDiv.textContent = ''; }, 5000);

  }



  // --- Podm√≠nky odemƒçen√≠ budov pro tr√©nink ---

  function isUnlockedForTraining(buildingId) {

    if (buildingId === 'barracks') {

      return buildingData.barracks && buildingData.barracks.level >= 1;

    }

    if (buildingId === 'stable') {

      return buildingData.stable && buildingData.stable.level >= 10 &&

             buildingData.academy && buildingData.academy.level >= 10;

    }

    return false;

  }



  // --- Podm√≠nka, zda je jednotka odemƒçena v√Ωzkumem ---

  function isUnitUnlocked(unit) {


  if (id === 'stable') {
    return buildingData.barracks && buildingData.barracks.level >= 10;
  }

    if (unit.researched) return true;

    return researchData[unit.id] === true;

  }



  // --- Vykreslen√≠ jednotek v kas√°rn√°ch nebo st√°j√≠ch ---

  function renderTraining(buildingId) {

    let listId = buildingId === 'barracks' ? 'training-list' : 'training-stable-list';

    const container = document.getElementById(listId);

    container.innerHTML = '';



    const units = unitsList[buildingId] || [];

    units.forEach(u => {

      const unlocked = isUnlockedForTraining(buildingId) && isUnitUnlocked(u);

      const div = document.createElement('div');

      div.className = 'unit-card' + (unlocked ? '' : ' inactive');



      const icon = document.createElement('div');

      icon.className = 'icon';

      icon.textContent = u.icon;



      const details = document.createElement('div');

      details.className = 'details';



      const title = document.createElement('div');

      title.className = 'title';

      title.textContent = u.name;



      const lvlReq = document.createElement('div');

      lvlReq.textContent = `Vy≈æaduje level budovy: ${u.requiredBuildingLevel}`;



      const stats = document.createElement('div');

      stats.innerHTML = `

        √ötok: ${u.attack} | Obrana: ${u.defense} <br />

        Obrana proti pƒõchotƒõ: ${u.defInfantry} | Obrana proti kon√≠m: ${u.defCavalry} <br />

        Spot≈ôeba obil√≠: ${u.grainPerHour} / hodina <br />

        Tr√©nink trv√°: ${u.trainingTime} min

      `;



      const count = document.createElement('div');

      count.textContent = `Poƒçet: ${armyData[u.id] || 0}`;



      const btn = document.createElement('button');

      btn.className = 'btn';

      btn.textContent = unlocked ? 'Tr√©novat 1' : 'Uzamƒçeno';

      btn.disabled = !unlocked || (trainingQueue[u.id] && trainingQueue[u.id].some(t => Date.now() < t.endTime));

      btn.onclick = () => startTrainingUnit(u.id);



      details.appendChild(title);

      details.appendChild(lvlReq);

      details.appendChild(stats);

      details.appendChild(count);

      details.appendChild(btn);



      div.appendChild(icon);

      div.appendChild(details);



      container.appendChild(div);

    });

  }



  // --- Zaƒç√°tek tr√©ninku jednotky (1 kus) ---

  function startTrainingUnit(unitId) {

    const unit = Object.values(unitsList).flat().find(u => u.id === unitId);

    if (!unit) return;



    // Spot≈ôeba obil√≠ bƒõhem tr√©ninku

    const grainNeeded = unit.grainPerHour / 60 * unit.trainingTime;

    if (floatResources.grain < grainNeeded) {

      alert("Nem√°≈° dostatek obil√≠ na tr√©nink.");

      return;

    }



    floatResources.grain -= grainNeeded;

    updateResourcesDisplay();



    if (!trainingQueue[unitId]) trainingQueue[unitId] = [];

    const endTime = Date.now() + unit.trainingTime * 60 * 1000;

    trainingQueue[unitId].push({ count: 1, endTime });



    saveToStorage();

    renderTraining(currentTab);

  }



  // --- Zpracov√°n√≠ fronty tr√©ninku ---

  function processTrainingQueue() {

    const now = Date.now();

    let changed = false;

    for (const unitId in trainingQueue) {

      const queue = trainingQueue[unitId];

      if (!queue) continue;

      for (let i = queue.length - 1; i >= 0; i--) {

        if (queue[i].endTime <= now) {

          armyData[unitId] = (armyData[unitId] || 0) + queue[i].count;

          queue.splice(i,1);

          changed = true;

        }

      }

      if (queue.length === 0) delete trainingQueue[unitId];

    }

    if (changed) {

      saveToStorage();

      renderTraining('barracks');

      renderTraining('stable');

      renderArmyList();

    }

  }



  // --- V√Ωzkum ---



  function isResearchUnlocked(research) {

    const building = buildingData[research.buildingId];

    if (!building) return false;

    return building.level >= research.buildingReq;

  }



  function renderResearch() {

    const container = document.getElementById('research-list');

    container.innerHTML = '';

    researchList.forEach(r => {

      const unlocked = isResearchUnlocked(r);

      const researched = researchData[r.unlocksUnit] || false;

      const inProgress = researchQueue[r.id] && researchQueue[r.id] > Date.now();



      const div = document.createElement('div');

      div.className = 'research-card' + (unlocked ? '' : ' inactive');



      const icon = document.createElement('div');

      icon.className = 'icon';

      let unit = Object.values(unitsList).flat().find(u => u.id === r.unlocksUnit);

      icon.textContent = unit ? unit.icon : '‚ùì';



      const details = document.createElement('div');

      details.className = 'details';



      const title = document.createElement('div');

      title.className = 'title';

      title.textContent = r.name;



      const req = document.createElement('div');

      req.textContent = `Vy≈æaduje: Akademie level ${r.buildingReq}`;



      const status = document.createElement('div');

      status.className = 'timer';



      if (researched) {

        status.textContent = 'V√Ωzkum dokonƒçen';

      } else if (inProgress) {

        status.textContent = 'V√Ωzkum prob√≠h√°: ' + formatTime(researchQueue[r.id] - Date.now());

      } else if (!unlocked) {

        status.textContent = 'Zamƒçeno';

      } else {

        status.textContent = '';

      }



      const btn = document.createElement('button');

      btn.className = 'btn';

      btn.textContent = researched ? 'Dokonƒçeno' : (inProgress ? 'V√Ωzkum prob√≠h√°' : 'Zaƒç√≠t v√Ωzkum');

      btn.disabled = researched || inProgress || !unlocked;

      btn.onclick = () => startResearch(r.id);



      details.appendChild(title);

      details.appendChild(req);

      details.appendChild(status);

      details.appendChild(btn);



      div.appendChild(icon);

      div.appendChild(details);



      container.appendChild(div);

    });

  }



  function startResearch(researchId) {

    if (researchQueue[researchId] && researchQueue[researchId] > Date.now()) {

      alert('V√Ωzkum u≈æ prob√≠h√°.');

      return;

    }

    const r = researchList.find(r => r.id === researchId);

    if (!r) return;

    const speed = getSpeedMultiplier();

    const duration = (r.time * 60 * 1000) / speed;

    researchQueue[researchId] = Date.now() + duration;

    saveToStorage();

    renderResearch();

  }



  function processResearchQueue() {

    let changed = false;

    const now = Date.now();

    for (const researchId in researchQueue) {

      const endTime = researchQueue[researchId];

      if (endTime && endTime <= now) {

        researchData[researchId] = true;

        researchQueue[researchId] = null;

        changed = true;

      }

    }

    if (changed) {

      saveToStorage();

      renderResearch();

      renderTraining('barracks');

      renderTraining('stable');

    }

  }



  // --- Shroma≈ædi≈°tƒõ (p≈ôehled arm√°dy) ---

  function renderArmyList() {

    const container = document.getElementById('army-list');

    container.innerHTML = '';

    const allUnits = Object.values(unitsList).flat();

    allUnits.forEach(u => {

      const count = armyData[u.id] || 0;

      if (count === 0) return;

      const div = document.createElement('div');

      div.className = 'army-unit';



      const icon = document.createElement('div');

      icon.className = 'icon';

      icon.textContent = u.icon;



      const name = document.createElement('div');

      name.textContent = u.name;



      const countDiv = document.createElement('div');

      countDiv.className = 'count';

      countDiv.textContent = count;



      div.appendChild(icon);

      div.appendChild(name);

      div.appendChild(countDiv);



      container.appendChild(div);

    });

    if(container.innerHTML === '') {

      container.textContent = 'Nem√°te ≈æ√°dn√© vycviƒçen√© jednotky.';

    }

  }



  // --- Tab switching ---



  const tabs = document.querySelectorAll('#tabs button');

  let currentTab = 'buildings';



  tabs.forEach(tab => {

    tab.addEventListener('click', () => {

      tabs.forEach(t => t.classList.remove('active'));

      tab.classList.add('active');

      currentTab = tab.dataset.tab;

      showTab(currentTab);

    });

  });



  function showTab(tab) {

    document.querySelectorAll('.tab-content').forEach(tc => tc.style.display = 'none');

    const el = document.getElementById('tab-' + tab);

    if (el) el.style.display = 'block';



    if(tab === 'buildings') renderBuildings();

    if(tab === 'barracks') renderTraining('barracks');

    if(tab === 'stable') renderTraining('stable');

    if(tab === 'academy') renderResearch();

    if(tab === 'rally') renderArmyList();

  }



  // --- Aktualizace ƒçasovaƒç≈Ø, front, atd. ---

  function updateTimers() {

    const now = Date.now();



    // Dokonƒçen√≠ staveb budov

    let buildingsChanged = false;

    for (const id in buildingData) {

      const b = buildingData[id];

      if (b.upgrading && b.upgradeEnd <= now) {

        b.level++;

        b.upgrading = false;

        b.upgradeEnd = null;

      if (!b.built) b.built = true;

      renderBuildings();

        buildingsChanged = true;

      }

    }

    if (buildingsChanged) {

      saveToStorage();

      if(currentTab==='buildings') renderBuildings();

      updateResourcesDisplay();

    }



    // V√Ωzkumy

    processResearchQueue();



    // Tr√©ninky

    processTrainingQueue();



    // Aktualizace UI timer≈Ø dle aktu√°ln√≠ z√°lo≈æky

    if (currentTab === 'buildings') renderBuildings();

    if (currentTab === 'barracks') renderTraining('barracks');

    if (currentTab === 'stable') renderTraining('stable');

    if (currentTab === 'academy') renderResearch();

    if (currentTab === 'rally') renderArmyList();



    updateTokensDisplay();

  }



  // --- Inicializace ---

  function init() {

    loadFromStorage();

    updateResourcesDisplay();

    updateTokensDisplay();

    showTab(currentTab);



    setInterval(() => {

      updateTimers();

    }, 1000);

  }



  init();





function isUnlockedBuilding(id) {

  if (id === 'granary' || id === 'warehouse') {

    return buildingData.main && buildingData.main.level >= 3;

  }

  if (id === 'barracks') {

    return buildingData.main && buildingData.main.level >= 5;

  }

  if (id === 'academy') {

    return buildingData.barracks && buildingData.barracks.level >= 3;

  }

if (id === 'stable') {

    return buildingData.barracks && buildingData.barracks.level >= 5;
 
  

}

return true;

} 

// ‚¨á SEM PASTEJNI TVOU FUNKCI
window.addEventListener('DOMContentLoaded', function () {
  document.getElementById('addTokensBtn').addEventListener('click', function () {
    const enteredPassword = prompt("Zadej heslo pro p≈ôid√°n√≠ zlat√Ωch:");
    if (enteredPassword === '1387') {
      const additionalTokens = 600;
      tokens += additionalTokens;
      updateTokensDisplay();
      alert(`P≈ôid√°no ${additionalTokens} zlat√Ωch! M√°te ${tokens} token≈Ø.`);
    } else {
      alert("‚ùå ≈†patn√© heslo. Zlato nebylo p≈ôid√°no.");
    }
  });
});



</script>



</body>

</html>
